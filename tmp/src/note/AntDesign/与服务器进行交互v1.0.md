> 此文档基于 Ant Design Pro v1

# 和服务端进行交互

## 前端请求流程

在 Ant Design Pro 中，一个完整的前端 UI 交互到服务端处理流程是这样的：

1. UI 组件交互
2. 调用 model 的 effect
3. 调用统一管理的 service 请求函数
4. 使用封装的 request.js 发送请求
5. 获取服务端返回
6. 调用 reducer 改变 state
7. 更新 model

从上面的流程可以看出，为了方便管理维护，统一的请求处理都放在 services 文件夹中，并且一般按照 model 维度进行拆分文件。

## Effect 处理异步请求

在处理复杂的异步请求的时候，很容易让人逻辑混乱，陷入嵌套陷进，所以 Ant Design Pro 的底层基础框架 dva 使用 effect 的方式来管理同步化异步请求：

通过 generator 和 yield 使得异步调用的逻辑处理跟同步一样。

此处省略。

# 从 mock 直接切换到服务器请求

通常来讲只要 mock 的接口和帧是的服务端接口保持一致，那么只需要重定向 mock 到对饮更多服务端接口即可。

```js
export default {
    'GET /api/(.*)': 'https://your.server.com/api/'
}
```

## 关闭 mock

关闭 mock 的方法我们推荐采用环境变量，可以在 package.json 中设置：

```json
"script": {
    "start": "roadhog server",
    "start:no-proxt": "cross-env NOPROXY=true roadhog server"
}
```

然后在 .roadhogrc.mock.js 中做个判断即可：

```js
const noProxy = process.env.NO_PROXY === 'true'
...
export default noProxy ? {} : delay(proxy, 1000)
```

